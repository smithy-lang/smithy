
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Event stream specification &#8212; Smithy 0.4.0 documentation</title><link rel="stylesheet" href="../_static/bootstrap-reboot.css" type="text/css" />
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.10/segment.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.10/menu.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom-tabs.css" type="text/css" />

    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sphinx_tabs/tabs.js"></script>
    <script type="text/javascript" src="../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.js"></script>
    <script type="text/javascript">
        function _scroll(subjectId) {
            var subjectElement = $(subjectId);
            var actualSubjectHeight = subjectElement.height();
            var startingPosition = subjectElement[0].getBoundingClientRect().top;
            return function() {
                var availableHeight = $(window).height() - startingPosition;
                // Subtract the scroll position to account for sticky movement.
                availableHeight += Math.min($(window).scrollTop(), 40);
                var cappedHeight = Math.min(actualSubjectHeight, availableHeight);
                if (subjectElement.css("height") !== cappedHeight) {
                    subjectElement.css("height", cappedHeight);
                }
            };
        }

        // Scroll and resize the the columns when scrolled.
        $(function() {
            var rightScroll = _scroll("#right-column > .column-body");
            var scrollFn = function() {
                rightScroll.call(this, arguments);
            };
            scrollFn();
            $(window).scroll(scrollFn);
            $(window).resize(scrollFn);
        });

        // Scroll spy to change highlighted navigation element.
        $(function() {
            var section = document.querySelectorAll(".section");
            var sections = {};
            var i = 0;
            Array.prototype.forEach.call(section, function(e) {
                sections[e.id] = e.offsetTop;
            });
            var scrollSpy = function() {
                var scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;
                for (i in sections) {
                    if (sections[i] <= scrollPosition) {
                        $('#right-column .current').removeClass('current');
                        $("#right-column a[href='#" + i + "']").addClass('current');
                    }
                }
            };
            $(window).scroll(scrollSpy);
            scrollSpy();
        });
    </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTP protocol bindings" href="http.html" />
    <link rel="prev" title="Selectors" href="selectors.html" /> 
  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="../index.html">
                    <span class="logo-icon">⚒️</span><span class="logo-text">Smithy</span><span class="beta-text">beta</span>
                </a>
            </div>
            <ul id="page-navigation">
                <li class="site-page first"><a href="../quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="index.html">Specifications</a></li>
                <li class="site-page"><a href="../guides/index.html">Guides</a></li>
                <li class="site-page"><a href="https://github.com/awslabs/smithy">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="../search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
        
        
        <section id="page-container">
            <div class="width-wrapper flex">
                <article id="document-body">
                    
  <div class="section" id="event-stream-specification">
<span id="event-streams"></span><h1>Event stream specification<a class="headerlink" href="#event-stream-specification" title="Permalink to this headline">¶</a></h1>
<p>An event stream is an abstraction that allows messages to be sent
asynchronously over a persistent connection between a client and server.
Event streams support both duplex and simplex streaming. The serialization
format and framing of messages sent over event streams is defined by the
<a class="reference internal" href="core.html#protocols-trait"><span class="std std-ref">protocol</span></a> of a service.</p>
<p>Event streams are defined on operations using the
<a class="reference internal" href="#inputeventstream-trait"><span class="std std-ref">inputEventStream trait</span></a> and <a class="reference internal" href="#outputeventstream-trait"><span class="std std-ref">outputEventStream trait</span></a>. These traits
reference a member of the input or output of an operation that targets the
shape sent over the event stream. A member that targets a structure is a
<em>single-event event stream</em>, and a member that targets a union is a
<em>multi-event event stream</em>.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#single-event-event-streams" id="id9">Single-event event streams</a><ul>
<li><a class="reference internal" href="#single-event-client-behavior" id="id10">Single-event client behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-event-event-streams" id="id11">Multi-event event streams</a><ul>
<li><a class="reference internal" href="#multi-event-client-behavior" id="id12">Multi-event client behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initial-messages" id="id13">Initial messages</a><ul>
<li><a class="reference internal" href="#initial-request" id="id14">Initial-request</a></li>
<li><a class="reference internal" href="#initial-response" id="id15">Initial-response</a></li>
<li><a class="reference internal" href="#initial-message-client-and-server-behavior" id="id16">Initial message client and server behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#event-message-serialization" id="id17">Event message serialization</a></li>
<li><a class="reference internal" href="#event-stream-traits" id="id18">Event stream traits</a><ul>
<li><a class="reference internal" href="#inputeventstream-trait" id="id19"><code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> trait</a></li>
<li><a class="reference internal" href="#outputeventstream-trait" id="id20"><code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait</a></li>
<li><a class="reference internal" href="#eventheader-trait" id="id21"><code class="docutils literal notranslate"><span class="pre">eventHeader</span></code> trait</a></li>
<li><a class="reference internal" href="#eventpayload-trait" id="id22"><code class="docutils literal notranslate"><span class="pre">eventPayload</span></code> trait</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="single-event-event-streams">
<span id="single-event-event-stream"></span><h2>Single-event event streams<a class="headerlink" href="#single-event-event-streams" title="Permalink to this headline">¶</a></h2>
<p>A <em>single-event event stream</em> is an event stream that streams zero or more
instances of a specific structure shape. It is formed when the
<code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> or <code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait references an input or
output member that targets a structure.</p>
<p id="single-event-input-eventstream">The following example defines an operation that uses a single-event event
stream in its input by referencing a member that targets a structure:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@inputEventStream</span>(<span class="s2">&quot;messages&quot;</span>)
<span class="kd">operation</span><span class="nc"> PublishMessages</span>(<span class="vc">PublishMessagesInput</span>)

<span class="kd">structure</span><span class="nc"> PublishMessagesInput</span> {
    <span class="nl">room:</span> <span class="vc">String</span>,
    <span class="nl">messages:</span> <span class="vc">Message</span>,
}

<span class="kd">structure</span><span class="nc"> Message</span> {
    <span class="nl">message:</span> <span class="vc">String</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;PublishMessages&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
                <span class="nt">&quot;input&quot;</span><span class="p">:</span> <span class="s2">&quot;PublishMessagesInput&quot;</span><span class="p">,</span>
                <span class="nt">&quot;inputEventStream&quot;</span><span class="p">:</span> <span class="s2">&quot;messages&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;PublishMessagesInput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;room&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;messages&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Message&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;Message&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p id="single-event-output-eventstream">The following example defines an operation that uses a single-event event
stream in its output:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@outputEventStream</span>(<span class="s2">&quot;movements&quot;</span>)
<span class="kd">operation</span><span class="nc"> SubscribeToMovements</span>() <span class="nd">-&gt;</span> <span class="vc">SubscribeToMovementsOutput</span>

<span class="kd">structure</span><span class="nc"> SubscribeToMovementsOutput</span> {
    <span class="nl">movements:</span> <span class="vc">Movement</span>,
}

<span class="kd">structure</span><span class="nc"> Movement</span> {
    <span class="nl">angle:</span> <span class="vc">Float</span>,
    <span class="nl">velocity:</span> <span class="vc">Float</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;SubscribeToMovements&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
                <span class="nt">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;SubscribeToMovementsOutput&quot;</span><span class="p">,</span>
                <span class="nt">&quot;outputEventStream&quot;</span><span class="p">:</span> <span class="s2">&quot;movements&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;SubscribeToMovementsOutput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;movements&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Movement&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;Movement&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;angle&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;velocity&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="single-event-client-behavior">
<h3>Single-event client behavior<a class="headerlink" href="#single-event-client-behavior" title="Permalink to this headline">¶</a></h3>
<p>Clients that send or receive single-event event streams are expected to
provide an abstraction to end-users that allows values to be produced or
consumed asynchronously for the targeted event structure. Because a
single-event event stream does not utilize named events like a multi-event
event stream, functionality used to dispatch based on named events is
unnecessary. Clients MUST provide access to the
<a class="reference internal" href="#initial-messages"><span class="std std-ref">initial-message</span></a> of an event stream when necessary.</p>
</div>
</div>
<div class="section" id="multi-event-event-streams">
<span id="multi-event-event-stream"></span><h2>Multi-event event streams<a class="headerlink" href="#multi-event-event-streams" title="Permalink to this headline">¶</a></h2>
<p>A <em>multi-event event stream</em> is an event stream that streams any number of
named event structure shapes defined by a union. It is formed when an
<code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> or <code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait references an input or
output member that targets a union. Each member of the targeted union MUST
target a structure shape. The member names of the
union define the name that is used to identify each event that is sent over
the event stream.</p>
<p id="multi-event-input-eventstream">The following example defines an operation that uses a multi-event event
stream in its input by referencing a member that targets a union:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@inputEventStream</span>(<span class="s2">&quot;messages&quot;</span>)
<span class="kd">operation</span><span class="nc"> PublishMessages</span>(<span class="vc">PublishMessagesInput</span>)

<span class="kd">structure</span><span class="nc"> PublishMessagesInput</span> {
    <span class="nl">room:</span> <span class="vc">String</span>,
    <span class="nl">messages:</span> <span class="vc">PublishEvents</span>,
}

<span class="kd">union</span><span class="nc"> PublishEvents</span> {
    <span class="nl">message:</span> <span class="vc">Message</span>,
    <span class="nl">leave:</span> <span class="vc">LeaveEvent</span>,
}

<span class="kd">structure</span><span class="nc"> Message</span> {
    <span class="nl">message:</span> <span class="vc">String</span>,
}

<span class="kd">structure</span><span class="nc"> LeaveEvent</span> {}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;PublishMessages&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
                <span class="nt">&quot;input&quot;</span><span class="p">:</span> <span class="s2">&quot;PublishMessagesInput&quot;</span><span class="p">,</span>
                <span class="nt">&quot;inputEventStream&quot;</span><span class="p">:</span> <span class="s2">&quot;messages&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;PublishMessagesInput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;room&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;messages&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;PublishEvents&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;PublishEvents&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;union&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Message&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;leave&quot;</span><span class="p">:</span> <span class="s2">&quot;LeaveEvent&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;Message&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p id="multi-event-output-eventstream">The following example defines an operation that uses a multi-event event
stream in its output:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@outputEventStream</span>(<span class="s2">&quot;movements&quot;</span>)
<span class="kd">operation</span><span class="nc"> SubscribeToMovements</span>() <span class="nd">-&gt;</span> <span class="vc">SubscribeToMovementsOutput</span>

<span class="kd">structure</span><span class="nc"> SubscribeToMovementsOutput</span> {
    <span class="nl">movements:</span> <span class="vc">MovementEvents</span>,
}

<span class="kd">union</span><span class="nc"> MovementEvents</span> {
    <span class="nl">up:</span> <span class="vc">Movement</span>,
    <span class="nl">down:</span> <span class="vc">Movement</span>,
    <span class="nl">left:</span> <span class="vc">Movement</span>,
    <span class="nl">right:</span> <span class="vc">Movement</span>,
}

<span class="kd">structure</span><span class="nc"> Movement</span> {
    <span class="nl">velocity:</span> <span class="vc">Float</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;SubscribeToMovements&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
                <span class="nt">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;SubscribeToMovementsOutput&quot;</span><span class="p">,</span>
                <span class="nt">&quot;outputEventStream&quot;</span><span class="p">:</span> <span class="s2">&quot;movements&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;SubscribeToMovementsOutput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;movements&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Message&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;MovementEvents&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;union&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;up&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Movement&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;down&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Movement&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;left&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Movement&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;right&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Movement&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;Movement&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;velocity&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Float&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multi-event-client-behavior">
<h3>Multi-event client behavior<a class="headerlink" href="#multi-event-client-behavior" title="Permalink to this headline">¶</a></h3>
<p>Clients that send or receive multi-event event streams are expected to
provide an abstraction to end-users that allows values to be produced or
consumed asynchronously for each named member of the targeted union. Adding
new events to an event stream union is considered a backward compatible
change; clients SHOULD NOT fail when an unknown event is received. Clients
MUST provide access to the <a class="reference internal" href="#initial-messages"><span class="std std-ref">initial-message</span></a> of an
event stream when necessary.</p>
<p>Clients SHOULD expose type-safe functionality that is used to dispatch based
on the name of an event. For example, given the following event stream,</p>
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@outputEventStream</span>(<span class="s2">&quot;movements&quot;</span>)
<span class="kd">operation</span><span class="nc"> SubscribeToEvents</span>() <span class="nd">-&gt;</span> <span class="vc">SubscribeToEventsOutput</span>

<span class="kd">structure</span><span class="nc"> SubscribeToEventsOutput</span> {
    <span class="nl">events:</span> <span class="vc">Events</span>,
}

<span class="kd">union</span><span class="nc"> Events</span> {
    <span class="nl">a:</span> <span class="vc">Event1</span>,
    <span class="nl">b:</span> <span class="vc">Event2</span>,
    <span class="nl">c:</span> <span class="vc">Event3</span>,
}

<span class="kd">structure</span><span class="nc"> Event1</span> {}
<span class="kd">structure</span><span class="nc"> Event2</span> {}
<span class="kd">structure</span><span class="nc"> Event3</span> {}
</pre></div>
</div>
<p>An abstraction SHOULD be provided that is used to dispatch based on the
name of an event (that is, <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, or <code class="docutils literal notranslate"><span class="pre">c</span></code>) and provide the associated
type (for example, when <code class="docutils literal notranslate"><span class="pre">a</span></code> is received, an event of type <code class="docutils literal notranslate"><span class="pre">Event1</span></code> is
provided).</p>
</div>
</div>
<div class="section" id="initial-messages">
<span id="id1"></span><h2>Initial messages<a class="headerlink" href="#initial-messages" title="Permalink to this headline">¶</a></h2>
<p>An <em>initial message</em> is comprised of the top-level input or output members
of an operation that are not referenced by the <code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> or
<code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> traits. Initial messages provide an opportunity for a
client or server to provide metadata about an event stream before transmitting
events.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Not all protocols support initial messages. Check trait binding and
protocol documentation before adding initial messages to an operation.</p>
</div>
<div class="section" id="initial-request">
<span id="id2"></span><h3>Initial-request<a class="headerlink" href="#initial-request" title="Permalink to this headline">¶</a></h3>
<p>An <em>initial-request</em> is an initial message that can be sent from a client to
a server for an operation marked with the <code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> trait. The
structure of an initial-request is the input of an operation with no value
provided for the event stream member referenced by the <code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code>
trait. An initial-request, if sent, is sent from a client to a server before
sending any event stream events.</p>
<p>When using <a class="reference internal" href="http.html#http-traits"><span class="std std-ref">HTTP bindings</span></a>, initial-request fields are
mapped to specific locations in the HTTP request such as headers or the
URI. In other bindings or protocols, the initial-request can be
sent however is necessary for the protocol.</p>
<p>The following example defines an operation with an input event stream with
an initial-request. The client will first send the initial-request to the
service, followed by the events sent in the payload of the HTTP message.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@inputEventStream</span>(<span class="s2">&quot;messages&quot;</span>)
<span class="nd">@http</span>(<span class="nl">method:</span> <span class="s2">&quot;POST&quot;</span>, <span class="nl">uri:</span> <span class="s2">&quot;/messages/{room}&quot;</span>)
<span class="kd">operation</span><span class="nc"> PublishMessages</span>(<span class="vc">PublishMessagesInput</span>)

<span class="kd">structure</span><span class="nc"> PublishMessagesInput</span> {
    <span class="nd">@httpLabel</span>
    <span class="nl">room:</span> <span class="vc">String</span>,

    <span class="nd">@httpPayload</span>
    <span class="nl">messages:</span> <span class="vc">Message</span>,
}

<span class="kd">structure</span><span class="nc"> Message</span> {
    <span class="nl">message:</span> <span class="vc">String</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;PublishMessages&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
                <span class="nt">&quot;input&quot;</span><span class="p">:</span> <span class="s2">&quot;PublishMessagesInput&quot;</span><span class="p">,</span>
                <span class="nt">&quot;inputEventStream&quot;</span><span class="p">:</span> <span class="s2">&quot;messages&quot;</span><span class="p">,</span>
                <span class="nt">&quot;http&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/messages/{room}&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;PublishMessagesInput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;room&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;httpLabel:&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;messages&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Message&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;httpPayload&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;Message&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="initial-response">
<span id="id3"></span><h3>Initial-response<a class="headerlink" href="#initial-response" title="Permalink to this headline">¶</a></h3>
<p>An <em>initial-response</em> is an initial message that can be sent from a server
to a client for an operation marked with the <code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait.
The structure of an initial-response is the output of an operation with no
value provided for the event stream member referenced by the
<code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait. An initial-response, if sent, is sent from the
server to the client before sending any event stream events.</p>
<p>When using <a class="reference internal" href="http.html#http-traits"><span class="std std-ref">HTTP bindings</span></a>, initial-response fields are
mapped to HTTP headers. In other protocols, the initial-response can be sent
however is necessary for the protocol.</p>
<p>The following example defines an operation with an output event stream with
an initial-response. The client will first receive and process the
initial-response, followed by the events sent in the payload of the HTTP
message.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="nd">@outputEventStream</span>(<span class="s2">&quot;messages&quot;</span>)
<span class="nd">@http</span>(<span class="nl">method:</span> <span class="s2">&quot;GET&quot;</span>, <span class="nl">uri:</span> <span class="s2">&quot;/messages/{room}&quot;</span>)
<span class="kd">operation</span><span class="nc"> SubscribeToMessages</span>(<span class="vc">SubscribeToMessagesInput</span>) <span class="nd">-&gt;</span> <span class="vc">SubscribeToMessagesOutput</span>

<span class="kd">structure</span><span class="nc"> SubscribeToMessagesInput</span> {
    <span class="nd">@httpLabel</span>
    <span class="nl">room:</span> <span class="vc">String</span>
}

<span class="kd">structure</span><span class="nc"> SubscribeToMessagesOutput</span> {
    <span class="nd">@httpHeader</span>(<span class="s2">&quot;X-Connection-Lifetime&quot;</span>)
    <span class="nl">connectionLifetime:</span> <span class="vc">Integer</span>,

    <span class="nd">@httpPayload</span>
    <span class="nl">messages:</span> <span class="vc">Message</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;PublishMessages&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
                <span class="nt">&quot;input&quot;</span><span class="p">:</span> <span class="s2">&quot;PublishMessagesInput&quot;</span><span class="p">,</span>
                <span class="nt">&quot;inputEventStream&quot;</span><span class="p">:</span> <span class="s2">&quot;messages&quot;</span><span class="p">,</span>
                <span class="nt">&quot;http&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/messages/{room}&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;SubscribeToMessagesInput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;room&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;httpLabel:&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;SubscribeToMessagesOutput&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;connectionLifetime&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Integer&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;httpHeader:&quot;</span><span class="p">:</span> <span class="s2">&quot;X-Connection-Lifetime&quot;</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;messages&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Message&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;httpPayload&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="initial-message-client-and-server-behavior">
<h3>Initial message client and server behavior<a class="headerlink" href="#initial-message-client-and-server-behavior" title="Permalink to this headline">¶</a></h3>
<p>Initial messages, if received, MUST be provided to applications
before event stream events.</p>
<p>It is a backward compatible change to add an initial-request or
initial-response to an existing operation; clients MUST NOT fail if an
unexpected initial-request or initial-response is received. Clients and
servers MUST NOT fail if an initial-request or initial-response is not
received for an initial message that contains only optional members.</p>
</div>
</div>
<div class="section" id="event-message-serialization">
<span id="id4"></span><h2>Event message serialization<a class="headerlink" href="#event-message-serialization" title="Permalink to this headline">¶</a></h2>
<p>While the framing and serialization of an event stream is protocol-specific,
traits can be used to influence the serialization of an event stream event.
Structure members that are sent as part of an event stream are serialized
in either a header or the payload of an event.</p>
<p>The <a class="reference internal" href="#eventheader-trait"><span class="std std-ref">eventHeader trait</span></a> is used to serialize a structure member as an
event header. The payload of an event is defined by either marking a single
member with the <a class="reference internal" href="#eventpayload-trait"><span class="std std-ref">eventPayload trait</span></a>, or by combining all members that
are not marked with the <code class="docutils literal notranslate"><span class="pre">eventHeader</span></code> or <code class="docutils literal notranslate"><span class="pre">eventPayload</span></code> trait into a
protocol-specific document.</p>
<p>The following example serializes the &quot;a&quot; and &quot;b&quot; members as event
headers and the &quot;c&quot; member as the payload.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">structure</span><span class="nc"> ExampleEvent</span> {
    <span class="nd">@eventHeader</span>
    <span class="nl">a:</span> <span class="vc">String</span>,

    <span class="nd">@eventHeader</span>
    <span class="nl">b:</span> <span class="vc">String</span>,

    <span class="nd">@eventPayload</span>
    <span class="nl">c:</span> <span class="vc">Blob</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;ExampleEvent&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventPayload&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventPayload&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Blob&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventPayload&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The following example serializes the &quot;a&quot;, &quot;b&quot;, and &quot;c&quot; members as the payload
of the event using a protocol-specific document. For example, when using a JSON
based protocol, the event payload is serialized as a JSON object:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">structure</span><span class="nc"> ExampleEvent</span> {
    <span class="nl">a:</span> <span class="vc">String</span>,
    <span class="nl">b:</span> <span class="vc">String</span>,
    <span class="nl">c:</span> <span class="vc">Blob</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;ExampleEvent&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">},</span>
                    <span class="nt">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">},</span>
                    <span class="nt">&quot;c&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;Blob&quot;</span><span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="event-stream-traits">
<h2>Event stream traits<a class="headerlink" href="#event-stream-traits" title="Permalink to this headline">¶</a></h2>
<div class="section" id="inputeventstream-trait">
<span id="id5"></span><h3><code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> trait<a class="headerlink" href="#inputeventstream-trait" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Summary</dt>
<dd>Configures an operation to use an event stream for its input.</dd>
<dt>Trait selector</dt>
<dd><p class="first"><code class="docutils literal notranslate"><span class="pre">operation:test(-[input]-&gt;)</span></code></p>
<p class="last">An operation that defines an input shape.</p>
</dd>
<dt>Value type</dt>
<dd>String value that is the name of a member of the operation input
structure. The referenced member MUST exist on the input structure
of the operation, MUST NOT be marked as required, and MUST target a
structure or a union that targets only structure shapes.</dd>
<dt>Examples</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#single-event-input-eventstream"><span class="std std-ref">Single-event event stream example</span></a></li>
<li><a class="reference internal" href="#multi-event-input-eventstream"><span class="std std-ref">Multi-event event stream example</span></a></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="outputeventstream-trait">
<span id="id6"></span><h3><code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait<a class="headerlink" href="#outputeventstream-trait" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Summary</dt>
<dd>Configures an operation to use an event stream for its output.</dd>
<dt>Trait selector</dt>
<dd><p class="first"><code class="docutils literal notranslate"><span class="pre">operation:test(-[output]-&gt;)</span></code></p>
<p class="last">An operation that defines an output shape.</p>
</dd>
<dt>Value type</dt>
<dd>String value that is the name of a member of the operation output
structure. The referenced member MUST exist on the output structure
of the operation, MUST NOT be marked as required, and MUST target
a structure or a union that targets only structure shapes.</dd>
<dt>Examples</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#single-event-output-eventstream"><span class="std std-ref">Single-event event stream example</span></a></li>
<li><a class="reference internal" href="#multi-event-output-eventstream"><span class="std std-ref">Multi-event event stream example</span></a></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="eventheader-trait">
<span id="id7"></span><h3><code class="docutils literal notranslate"><span class="pre">eventHeader</span></code> trait<a class="headerlink" href="#eventheader-trait" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Summary</dt>
<dd>Binds a member of a structure to be serialized as an event header when
sent through an event stream.</dd>
<dt>Trait selector</dt>
<dd><div class="first highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">member</span><span class="p">:</span><span class="nd">of</span><span class="o">(</span><span class="nt">structure</span><span class="o">)</span><span class="p">:</span><span class="nd">test</span><span class="o">(</span> <span class="o">&gt;</span> <span class="p">:</span><span class="nd">each</span><span class="o">(</span><span class="nt">boolean</span><span class="o">,</span> <span class="nt">byte</span><span class="o">,</span> <span class="nt">short</span><span class="o">,</span> <span class="nt">integer</span><span class="o">,</span> <span class="nt">long</span><span class="o">,</span> <span class="nt">blob</span><span class="o">,</span> <span class="nt">string</span><span class="o">,</span> <span class="nt">timestamp</span><span class="o">))</span>
</pre></div>
</div>
<p class="last"><em>Member of a structure that targets a boolean, byte, short, integer, long, blob, string, or timestamp shape</em></p>
</dd>
<dt>Value type</dt>
<dd>Annotation trait.</dd>
<dt>Conflicts with</dt>
<dd><a class="reference internal" href="#eventpayload-trait"><span class="std std-ref">eventPayload trait</span></a></dd>
</dl>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Not all protocols support event headers. For example, MQTT version 3.1.1
does not support custom message headers. It is a protocol-level concern
as to if and how event stream headers are serialized.</p>
</div>
<p>The following example defines multiple event headers:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">structure</span><span class="nc"> ExampleEvent</span> {
    <span class="nd">@eventHeader</span>
    <span class="nl">a:</span> <span class="vc">String</span>,

    <span class="nd">@eventHeader</span>
    <span class="nl">b:</span> <span class="vc">String</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;ExampleEvent&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventHeader&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventHeader&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="eventpayload-trait">
<span id="id8"></span><h3><code class="docutils literal notranslate"><span class="pre">eventPayload</span></code> trait<a class="headerlink" href="#eventpayload-trait" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Summary</dt>
<dd>Binds a member of a structure to be serialized as the payload of an
event sent through an event stream.</dd>
<dt>Trait selector</dt>
<dd><div class="first highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">member</span><span class="p">:</span><span class="nd">of</span><span class="o">(</span><span class="nt">structure</span><span class="o">)</span><span class="p">:</span><span class="nd">test</span><span class="o">(&gt;</span> <span class="p">:</span><span class="nd">each</span><span class="o">(</span><span class="nt">blob</span><span class="o">,</span> <span class="nt">string</span><span class="o">,</span> <span class="nt">structure</span><span class="o">,</span> <span class="nt">union</span><span class="o">))</span>
</pre></div>
</div>
<p class="last"><em>Structure member that targets a blob, string, structure, or union</em></p>
</dd>
<dt>Value type</dt>
<dd>Annotation trait.</dd>
<dt>Conflicts with</dt>
<dd><a class="reference internal" href="#eventheader-trait"><span class="std std-ref">eventHeader trait</span></a></dd>
<dt>Validation</dt>
<dd><ol class="first last arabic simple">
<li>This trait is <em>structurally exclusive</em>, meaning only a single member
of a structure can be targeted by the trait.</li>
<li>If the <code class="docutils literal notranslate"><span class="pre">eventPayload</span></code> trait is applied to a structure member,
then all other members of the structure MUST be marked with the
<code class="docutils literal notranslate"><span class="pre">eventHeader</span></code> trait.</li>
</ol>
</dd>
</dl>
<p>Event payload is serialized using the following logic:</p>
<ul class="simple">
<li>A blob and string is serialized using the bytes of the string or blob.</li>
<li>A structure and union is serialized as a protocol-specific document.</li>
</ul>
<p>The following example defines an event header and sends a blob as the payload
of an event:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">structure</span><span class="nc"> ExampleEvent</span> {
    <span class="nd">@eventPayload</span>
    <span class="nl">a:</span> <span class="vc">String</span>,

    <span class="nd">@eventHeader</span>
    <span class="nl">b:</span> <span class="vc">String</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;smithy.example&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;ExampleEvent&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
                <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventPayload&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;eventHeader&quot;</span><span class="p">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The following structure is <strong>invalid</strong> because the &quot;a&quot; member is bound to the
<code class="docutils literal notranslate"><span class="pre">eventPayload</span></code>, and the &quot;b&quot; member is not bound to an <code class="docutils literal notranslate"><span class="pre">eventHeader</span></code>.</p>
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">structure</span><span class="nc"> ExampleEvent</span> {
    <span class="nd">@eventPayload</span>
    <span class="nl">a:</span> <span class="vc">String</span>,

    <span class="nl">b:</span> <span class="vc">String</span>,
    <span class="c">// ^ Error: not bound to an eventHeader.</span>
}
</pre></div>
</div>
</div>
</div>
</div>



                    
                    <section class="relations">
                        
                        <a href="selectors.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Selectors</a>
                        
                        <a href="http.html" title="next chapter" class="next-page clearfix">HTTP protocol bindings →</a>
                    </section>
                    
                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            <ul>
<li><a class="reference internal" href="#">Event stream specification</a><ul>
<li><a class="reference internal" href="#single-event-event-streams">Single-event event streams</a><ul>
<li><a class="reference internal" href="#single-event-client-behavior">Single-event client behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-event-event-streams">Multi-event event streams</a><ul>
<li><a class="reference internal" href="#multi-event-client-behavior">Multi-event client behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initial-messages">Initial messages</a><ul>
<li><a class="reference internal" href="#initial-request">Initial-request</a></li>
<li><a class="reference internal" href="#initial-response">Initial-response</a></li>
<li><a class="reference internal" href="#initial-message-client-and-server-behavior">Initial message client and server behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#event-message-serialization">Event message serialization</a></li>
<li><a class="reference internal" href="#event-stream-traits">Event stream traits</a><ul>
<li><a class="reference internal" href="#inputeventstream-trait"><code class="docutils literal notranslate"><span class="pre">inputEventStream</span></code> trait</a></li>
<li><a class="reference internal" href="#outputeventstream-trait"><code class="docutils literal notranslate"><span class="pre">outputEventStream</span></code> trait</a></li>
<li><a class="reference internal" href="#eventheader-trait"><code class="docutils literal notranslate"><span class="pre">eventHeader</span></code> trait</a></li>
<li><a class="reference internal" href="#eventpayload-trait"><code class="docutils literal notranslate"><span class="pre">eventPayload</span></code> trait</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>
        
    
<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>©2019, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>