
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smithy Server Generator for TypeScript handlers &#8212; Smithy 1.0 documentation</title><link rel="stylesheet" href="../_static/bootstrap-reboot.css" type="text/css" />
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" href="../_static/custom-tabs.css" type="text/css" />

    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/smithy.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Smithy Server Generator for TypeScript validation" href="validation.html" />
    <link rel="prev" title="Introduction to the Smithy Server Generator for TypeScript" href="introduction.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="smithy-version" content="1.0">

  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="../index.html">
                    <span class="logo-icon">üî®Ô∏è</span><span class="logo-text">Smithy</span>
                </a>
                <span class="version-text">1.0</span>
            </div>
            <ul id="page-navigation">
                <li class="site-page first"><a href="../quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="../1.0/spec/index.html">Specifications</a></li>
                <li class="site-page"><a href="../1.0/guides/index.html">Guides</a></li>
                <li class="site-page"><a href="https://github.com/awslabs/smithy">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="../search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
        
        
        <section id="page-container">
            <div class="width-wrapper flex">
                <article class="document-body">
                    
                    <ul class="rel-parents">
                    <li><a href="index.html" accesskey="U">Smithy Server Generator for TypeScript</a></li>
                    </ul>
                    
                    
  <div class="section" id="smithy-server-generator-for-typescript-handlers">
<h1><a href="#smithy-server-generator-for-typescript-handlers">Smithy Server Generator for TypeScript handlers</a></h1>
<p>The primary abstraction of a Smithy server is <code class="docutils literal notranslate"><span class="pre">ServiceHandler</span></code>, the interface to the server's
generated implementation that a service's code will build and call directly.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">interface</span> <span class="nx">ServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">RequestType</span> <span class="o">=</span> <span class="nx">HttpRequest</span><span class="p">,</span> <span class="nx">ResponseType</span> <span class="o">=</span> <span class="nx">HttpResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nx">handle</span><span class="p">(</span><span class="nx">request</span>: <span class="kt">RequestType</span><span class="p">,</span> <span class="nx">context</span>: <span class="kt">Context</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ResponseType</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">ServiceHandler</span></code> is simply a function that takes in a request (by default, an <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code>) and an optional
<code class="docutils literal notranslate"><span class="pre">Context</span></code> of arbitrary type, and returns a response (by default, an <code class="docutils literal notranslate"><span class="pre">HttpResponse</span></code>).</p>
<p>The Smithy Server Generator for TypeScript generates two different sets of handlers: one handler for the service as a
whole, and another handler for each individual operation in the service. This allows the service to choose the handler
that works best for their situation.</p>
<p>The primary difference between service-level and operation-level handlers is where routing (the matching of requests
to Smithy operations) is performed. Operation-level handlers assume that routing is handled outside of the server SDK,
which is commonly the case when a service like Amazon API Gateway is used. Service-level handlers are used when all
requests from an endpoint are handled by a handler, which would be the case when using Node.js's built-in HTTP server.</p>
<p>Consider a service with the following Smithy declaration:</p>
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="nd">@restJson1</span><span class="w"></span>
<span class="kd">service</span><span class="nc"> StringWizard</span><span class="w"> </span>{<span class="w"></span>
<span class="w">    </span><span class="nl">version:</span><span class="w"> </span><span class="s2">&quot;2018-05-10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nl">operations:</span><span class="w"> </span>[<span class="vc">Echo</span><span class="p">,</span><span class="w"> </span><span class="vc">Length</span>]<span class="w"></span>
}<span class="w"></span>
</pre></div>
</div>
<p>The SSDK will generate three different implementations of <code class="docutils literal notranslate"><span class="pre">ServiceHandler</span></code>. One for <code class="docutils literal notranslate"><span class="pre">StringWizard</span></code>:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">class</span> <span class="nx">StringWizardServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="k">implements</span> <span class="nx">ServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div>
</div>
<p>As well as one for <code class="docutils literal notranslate"><span class="pre">Echo</span></code> and one for <code class="docutils literal notranslate"><span class="pre">Length</span></code>:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">class</span> <span class="nx">EchoHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="k">implements</span> <span class="nx">ServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">LengthHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="k">implements</span> <span class="nx">ServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div>
</div>
<div class="section" id="servicehandler-factories">
<h2><a href="#servicehandler-factories">ServiceHandler factories</a></h2>
<p>Each handler class is protocol-agnostic; the implementation details of protocol serialization, deserialization, and
routing are passed into the handler class's constructor. For convenience, a factory method is generated for the
service's protocol that supply the necessary parameters to the handlers' constructors.</p>
<p>For instance, for the <code class="docutils literal notranslate"><span class="pre">Length</span></code> operation of <code class="docutils literal notranslate"><span class="pre">StringWizard</span></code>, a corresponding handler factory function is generated:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">const</span> <span class="nx">getLengthHandler</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">operation</span>: <span class="kt">Operation</span><span class="o">&lt;</span><span class="nx">LengthServerInput</span><span class="p">,</span> <span class="nx">LengthServerOutput</span><span class="p">,</span> <span class="nx">Context</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">ServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">HttpRequest</span><span class="p">,</span> <span class="nx">HttpResponse</span><span class="o">&gt;</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div>
</div>
<p>The only parameter of <code class="docutils literal notranslate"><span class="pre">getLengthParameter</span></code> is an implementation of
<code class="docutils literal notranslate"><span class="pre">Operation&lt;LengthServerInput,</span> <span class="pre">LengthServerOutput,</span> <span class="pre">Context&gt;</span></code>. <code class="docutils literal notranslate"><span class="pre">Operation</span></code> is a type distributed in
<code class="docutils literal notranslate"><span class="pre">&#64;aws-smithy/server-common</span></code> that server developers implement in order to perform the business logic of an operation
described in their Smithy model.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kr">type</span> <span class="nx">Operation</span><span class="o">&lt;</span><span class="nx">I</span><span class="p">,</span> <span class="nx">O</span><span class="p">,</span> <span class="nx">Context</span> <span class="o">=</span> <span class="p">{}</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span>: <span class="kt">I</span><span class="p">,</span> <span class="nx">context</span>: <span class="kt">Context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">O</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>The Lambda implementation of the <code class="docutils literal notranslate"><span class="pre">Length</span></code> operation can then be as simple as:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="c1">// getLengthHandler is the code generated handler factory</span>
<span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="nx">getLengthHandler</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">length</span>: <span class="kt">input.string?.length</span><span class="p">,</span>
        <span class="nx">$metadata</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">};</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">lambdaHandler</span>: <span class="kt">APIGatewayProxyHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">APIGatewayProxyResult</span><span class="o">&gt;</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// This uses the shim from @aws-smithy/server-apigateway to convert APIGateway events to HttpRequests</span>
    <span class="kd">const</span> <span class="nx">httpRequest</span> <span class="o">=</span> <span class="nx">convertEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">httpResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">,</span> <span class="p">{});</span>

    <span class="c1">// This uses the shim from @aws-smithy/server-apigateway to convert HttpResponses to APIGateway events</span>
    <span class="k">return</span> <span class="nx">convertVersion1Response</span><span class="p">(</span><span class="nx">httpResponse</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">getLengthHandler</span></code> is code generated against the input and output types of the <code class="docutils literal notranslate"><span class="pre">Length</span></code> operation, this code
has the additional benefit of being type-safe, even though the incoming event is simply a raw HTTP request.
Additionally, although <code class="docutils literal notranslate"><span class="pre">getLengthHandler</span></code> can only service requests for the <code class="docutils literal notranslate"><span class="pre">Length</span></code> operation, it still asserts
that the incoming request matches the modeled expectations for <code class="docutils literal notranslate"><span class="pre">Length</span></code>. This means if the developer accidentally
deploys the code for <code class="docutils literal notranslate"><span class="pre">Length</span></code> to the Lambda function for <code class="docutils literal notranslate"><span class="pre">Echo</span></code>, the handler will reject the request instead of
passing it onto the business logic and executing the wrong code.</p>
<p>The handler factory function for services, is similar, but instead of requiring an implementation of <code class="docutils literal notranslate"><span class="pre">Operation</span></code>,
it requires an implementation of every <code class="docutils literal notranslate"><span class="pre">Operation</span></code> in the service. For instance, for <code class="docutils literal notranslate"><span class="pre">StringWizardService</span></code>,
the handler factory function looks like this:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">const</span> <span class="nx">getStringWizardServiceHandler</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">service</span>: <span class="kt">StringWizardService</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">__ServiceHandler</span><span class="o">&lt;</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">__HttpRequest</span><span class="p">,</span> <span class="nx">__HttpResponse</span><span class="o">&gt;</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StringWizardService</span></code> is a generated interface with the following definition:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">interface</span> <span class="nx">StringWizardService</span><span class="o">&lt;</span><span class="nx">Context</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">Echo</span>: <span class="kt">Operation</span><span class="o">&lt;</span><span class="nx">EchoServerInput</span><span class="p">,</span> <span class="nx">EchoServerOutput</span><span class="p">,</span> <span class="nx">Context</span><span class="o">&gt;</span>
  <span class="nx">Length</span>: <span class="kt">Operation</span><span class="o">&lt;</span><span class="nx">LengthServerInput</span><span class="p">,</span> <span class="nx">LengthServerOutput</span><span class="p">,</span> <span class="nx">Context</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This conveys the same type-safety benefits as the operation-level handler factory, as well as ensuring that any
service handler has an implementation for every operation in the service. This means type checks will fail if your
model adds an operation, but the service's source code is not properly updated to add an implementation for it.</p>
</div>
<div class="section" id="contexts">
<span id="ts-ssdk-context"></span><h2><a href="#contexts">Contexts</a></h2>
<p>All handlers take an arbitrary <code class="docutils literal notranslate"><span class="pre">Context</span></code> of a type specified at runtime via the handler's <code class="docutils literal notranslate"><span class="pre">Context</span></code> generic type
argument. This allows the service developer to pass unmodeled data from the request or runtime environment to their
business logic.</p>
<p>For instance, a server running in AWS Lambda behind Amazon API Gateway could define a context that includes the calling
user's ARN, in order to do authorization checks in their business logic:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nx">HandlerContext</span> <span class="p">{</span>
  <span class="nx">user</span>: <span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and then modify their entry-point implementation to extract the user's identity from the incoming request and pass it to
the handler:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">export</span> <span class="kd">const</span> <span class="nx">lambdaHandler</span>: <span class="kt">APIGatewayProxyHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">APIGatewayProxyResult</span><span class="o">&gt;</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">httpRequest</span> <span class="o">=</span> <span class="nx">convertEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">userArn</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">requestContext</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nx">userArn</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">userArn</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="ow">new</span> <span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;IAM Auth is not enabled&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">user</span>: <span class="kt">userArn</span> <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">httpResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">httpRequest</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">convertVersion1Response</span><span class="p">(</span><span class="nx">httpResponse</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The value of <code class="docutils literal notranslate"><span class="pre">Context</span></code> is not constrained or modified by the server SDK in any way; it is passed through unmodified to
the <code class="docutils literal notranslate"><span class="pre">Operation</span></code> implementation.</p>
</div>
</div>


                    
                    <section class="relations">
                        
                        <a href="introduction.html" title="previous chapter" class="previous-page clearfix hidden-xs">‚Üê Introduction to the Smithy Server Generator for TypeScript</a>
                        
                        <a href="validation.html" title="next chapter" class="next-page clearfix">Smithy Server Generator for TypeScript validation ‚Üí</a>
                    </section>
                    
                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            
                            <section class="next-previous">
                                
                                <a href="introduction.html" title="previous chapter" class="previous-page clearfix hidden-xs">‚Üê Prev</a>
                                
                                <a href="validation.html" title="next chapter" class="next-page clearfix">Next ‚Üí</a>
                            </section>
                            
                            <ul>
<li><a class="reference internal" href="#">Smithy Server Generator for TypeScript handlers</a><ul>
<li><a class="reference internal" href="#servicehandler-factories">ServiceHandler factories</a></li>
<li><a class="reference internal" href="#contexts">Contexts</a></li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>
        
    
<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>¬©2021, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>